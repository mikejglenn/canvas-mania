/*
This is a modified and partially broken version of Phaser Virtual Joystick plugin. It's of no use for you. Support Phaser and pay for the plugin complete with docs and examples :-).
*/
Phaser.VirtualJoystick=function(game,parent){Phaser.Plugin.call(this,game,parent);this.sticks=null;this.buttons=null;this._pointerTotal=0};Phaser.VirtualJoystick.prototype=Object.create(Phaser.Plugin.prototype);Phaser.VirtualJoystick.prototype.constructor=Phaser.VirtualJoystick;Phaser.VirtualJoystick.NONE=0;Phaser.VirtualJoystick.HORIZONTAL=1;Phaser.VirtualJoystick.VERTICAL=2;Phaser.VirtualJoystick.CIRC_BUTTON=0;Phaser.VirtualJoystick.RECT_BUTTON=1;Phaser.VirtualJoystick.prototype.init=function(){this.sticks=new Phaser.ArraySet;this.buttons=new Phaser.ArraySet};Phaser.VirtualJoystick.prototype.addStick=function(x,y,distance,texture,baseFrame,stickFrame){if(typeof baseFrame==="undefined"){baseFrame="base"}if(typeof stickFrame==="undefined"){stickFrame="stick"}var stick=new Phaser.VirtualJoystick.Stick(this,x,y,distance,texture,baseFrame,stickFrame);this.sticks.add(stick);this._pointerTotal++;if(this._pointerTotal>2){this.game.input.addPointer()}return stick};Phaser.VirtualJoystick.prototype.addDPad=function(x,y,distance,texture,neutralFrame,upFrame,downFrame,leftFrame,rightFrame){if(typeof neutralFrame==="undefined"){neutralFrame="neutral"}if(typeof upFrame==="undefined"){upFrame="up"}if(typeof downFrame==="undefined"){downFrame="down"}if(typeof leftFrame==="undefined"){leftFrame="left"}if(typeof rightFrame==="undefined"){rightFrame="right"}var stick=new Phaser.VirtualJoystick.DPad(this,x,y,distance,texture,neutralFrame,upFrame,downFrame,leftFrame,rightFrame);this.sticks.add(stick);this._pointerTotal++;if(this._pointerTotal>2){this.game.input.addPointer()}return stick};Phaser.VirtualJoystick.prototype.removeStick=function(stick){this.sticks.remove(stick);stick.destroy()};Phaser.VirtualJoystick.prototype.addButton=function(x,y,texture,upFrame,downFrame,shape){if(typeof shape==="undefined"){shape=Phaser.VirtualJoystick.CIRC_BUTTON}var button=new Phaser.VirtualJoystick.Button(this,shape,x,y,texture,upFrame,downFrame);this.buttons.add(button);this._pointerTotal++;if(this._pointerTotal>2){this.game.input.addPointer()}return button};Phaser.VirtualJoystick.prototype.removeButton=function(button){this.buttons.remove(button);button.destroy()};Phaser.VirtualJoystick.prototype.update=function(){this.sticks.callAll("update");this.buttons.callAll("update")};Phaser.VirtualJoystick.prototype.destroy=function(){this.sticks.removeAll(true);this.buttons.removeAll(true)};Phaser.VirtualJoystick.Stick=function(pad,x,y,distance,texture,baseFrame,stickFrame){this.pad=pad;this.baseFrame=baseFrame;this.stickFrame=stickFrame;this.position=new Phaser.Point(x,y);this.line=new Phaser.Line(this.position.x,this.position.y,this.position.x,this.position.y);this.baseSprite=this.pad.game.make.sprite(this.position.x,this.position.y,texture,baseFrame);this.baseSprite.anchor.set(.5);this.stickSprite=this.pad.game.make.sprite(this.position.x,this.position.y,texture,stickFrame);this.stickSprite.anchor.set(.5);this.baseHitArea=new Phaser.Circle(this.position.x,this.position.y,distance);this.stickHitArea=new Phaser.Circle(this.position.x,this.position.y,this.stickSprite.width);this.limitPoint=new Phaser.Point;this.pointer=null;this.enabled=true;this.isDown=false;this.isUp=true;this.onDown=new Phaser.Signal;this.onUp=new Phaser.Signal;this.onMove=new Phaser.Signal;this.onUpdate=new Phaser.Signal;this.timeDown=0;this.timeUp=0;this.angle=0;this.angleFull=0;this.quadrant=0;this.multiQuadrant=[];this.multiDirections={up:false,right:false,down:false,left:false};this.octant=0;this.motionLock=Phaser.VirtualJoystick.NONE;this._distance=distance;this._deadZone=distance*.15;this._scale=1;this._tracking=false;this._showOnTouch=false;this.pad.game.stage.addChild(this.baseSprite);this.pad.game.stage.addChild(this.stickSprite);this.pad.game.input.onDown.add(this.checkDown,this);this.pad.game.input.onUp.add(this.checkUp,this);this.pad.game.input.addMoveCallback(this.moveStick,this)};Phaser.VirtualJoystick.Stick.prototype={checkDown:function(pointer){if(this.enabled&&this.isUp){this.pointer=pointer;if(this.motionLock===Phaser.VirtualJoystick.NONE){this.line.end.copyFrom(this.pointer)}else if(this.motionLock===Phaser.VirtualJoystick.HORIZONTAL){this.line.end.x=this.pointer.x}else if(this.motionLock===Phaser.VirtualJoystick.VERTICAL){this.line.end.y=this.pointer.y}if(this._showOnTouch){this.line.start.copyFrom(pointer);this.posX=pointer.x;this.posY=pointer.y;this.visible=true;this.setDown()}else{if(this.stickHitArea.contains(pointer.x,pointer.y)){if(this.line.length<=this.deadZone){this._tracking=true}else{this.setDown();this.moveStick()}}}}},checkUp:function(pointer){if(pointer===this.pointer){this.pointer=null;this.stickHitArea.x=this.position.x;this.stickHitArea.y=this.position.y;this.stickSprite.x=this.stickHitArea.x;this.stickSprite.y=this.stickHitArea.y;this.line.end.copyFrom(this.line.start);this.isDown=false;this.isUp=true;this.timeUp=this.pad.game.time.time;this.onUp.dispatch(this,pointer);if(this._showOnTouch){this.visible=false}}},setDown:function(){this.isDown=true;this.isUp=false;this.timeDown=this.pad.game.time.time;this.timeUp=0;this._tracking=false;this.checkArea();this.onDown.dispatch(this,this.pointer)},checkArea:function(){this.angle=this.pad.game.math.radToDeg(this.line.angle);this.angleFull=this.angle;this.spread=20;this.multiQuadrant=[false,false,false,false];this.multiDirections={up:false,right:false,down:false,left:false};if(this.angleFull<0){this.angleFull+=360}this.octant=45*Math.round(this.angleFull/45);if(this.angleFull+this.spread>=45&&this.angleFull-this.spread<135){this.quadrant=1;this.multiQuadrant[1]=true}else if(this.angleFull+this.spread>=225&&this.angleFull-this.spread<315){this.quadrant=3;this.multiQuadrant[3]=true}if(this.angleFull+this.spread>=135&&this.angleFull-this.spread<225){this.quadrant=2;this.multiQuadrant[2]=true}else if(this.angleFull+this.spread>=315||this.angleFull-this.spread<45){this.quadrant=0;this.multiQuadrant[0]=true}},moveStick:function(){if(!this.pointer||!this.isDown&&!this._tracking){return}if(this.motionLock===Phaser.VirtualJoystick.NONE){this.line.end.copyFrom(this.pointer)}else if(this.motionLock===Phaser.VirtualJoystick.HORIZONTAL){this.line.end.x=this.pointer.x}else if(this.motionLock===Phaser.VirtualJoystick.VERTICAL){this.line.end.y=this.pointer.y}this.checkArea();if(!this.isDown&&this.line.length<=this.deadZone){return}if(this._tracking){this.setDown()}if(this.line.length<this.baseHitArea.radius){if(this.motionLock===Phaser.VirtualJoystick.NONE){this.stickHitArea.x=this.pointer.x;this.stickHitArea.y=this.pointer.y}else if(this.motionLock===Phaser.VirtualJoystick.HORIZONTAL){this.stickHitArea.x=this.pointer.x}else if(this.motionLock===Phaser.VirtualJoystick.VERTICAL){this.stickHitArea.y=this.pointer.y}}else{this.baseHitArea.circumferencePoint(this.line.angle,false,this.limitPoint);if(this.motionLock===Phaser.VirtualJoystick.NONE){this.stickHitArea.x=this.limitPoint.x;this.stickHitArea.y=this.limitPoint.y}else if(this.motionLock===Phaser.VirtualJoystick.HORIZONTAL){this.stickHitArea.x=this.limitPoint.x}else if(this.motionLock===Phaser.VirtualJoystick.VERTICAL){this.stickHitArea.y=this.limitPoint.y}}this.stickSprite.x=this.stickHitArea.x;this.stickSprite.y=this.stickHitArea.y;this.onMove.dispatch(this,this.force,this.forceX,this.forceY)},update:function(){if(this.isDown&&!this._tracking){this.onUpdate.dispatch(this,this.force,this.forceX,this.forceY)}},alignBottomLeft:function(spacing){if(typeof spacing==="undefined"){spacing=0}var w=this.baseSprite.width/2+spacing;var h=this.baseSprite.height/2+spacing;this.posX=w;this.posY=this.pad.game.height-h},alignBottomRight:function(spacing){if(typeof spacing==="undefined"){spacing=0}var w=this.baseSprite.width/2+spacing;var h=this.baseSprite.height/2+spacing;this.posX=this.pad.game.width-w;this.posY=this.pad.game.height-h},destroy:function(){this.pad.game.input.onDown.remove(this.checkDown,this);this.pad.game.input.onUp.remove(this.checkUp,this);var mc=this.pad.game.input.moveCallbacks;for(var i=0;i<mc.length;i++){if(mc.callback===this.moveStick&&mc.context===this){mc.splice(i,1);break}}this.stickSprite.destroy();this.baseSprite.destroy();this.stickHitArea=null;this.baseHitArea=null;this.line=null;this.limitPoint=null;this.onDown.dispose();this.onUp.dispose();this.onMove.dispose();this.onUpdate.dispose();this.pointer=null;this._scale=null;this.pad=null},debug:function(sticks,text,x){if(typeof sticks==="undefined"){sticks=true}if(typeof text==="undefined"){text=true}if(typeof x==="undefined"){x=this.baseSprite.right}var debug=this.pad.game.debug;if(sticks){debug.context.lineWidth=2;debug.geom(this.baseHitArea,"rgba(255, 0, 0, 1)",false);debug.geom(this.stickHitArea,"rgba(0, 255, 0, 1)",false);debug.geom(this.line,"rgba(255, 255, 0, 1)");debug.context.lineWidth=1}if(text){var shadow=debug.renderShadow;var tx=x;var ty=this.baseSprite.y-114;debug.renderShadow=true;debug.text("Force: "+this.force.toFixed(2),tx,ty);debug.text("ForceX: "+this.forceX.toFixed(2),tx,ty+24);debug.text("ForceY: "+this.forceY.toFixed(2),tx,ty+48);debug.text("Rotation: "+this.rotation.toFixed(2),tx,ty+96);debug.text("Angle: "+this.angle.toFixed(2),tx,ty+120);debug.text("Distance: "+this.distance,tx,ty+172);debug.text("Quadrant: "+this.quadrant,tx,ty+196);debug.text("Octant: "+this.octant,tx,ty+220);debug.renderShadow=shadow}}};Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"rotation",{get:function(){return this.line.angle}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"posX",{get:function(){return this.position.x},set:function(x){if(this.position.x!==x){this.position.x=x;this.baseSprite.x=x;this.stickSprite.x=x;this.baseHitArea.x=x;this.stickHitArea.x=x;this.line.start.x=x;this.line.end.x=x}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"posY",{get:function(){return this.position.y},set:function(y){if(this.position.y!==y){this.position.y=y;this.baseSprite.y=y;this.stickSprite.y=y;this.baseHitArea.y=y;this.stickHitArea.y=y;this.line.start.y=y;this.line.end.y=y}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"force",{get:function(){return Math.min(1,this.line.length/this.distance*2)}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"forceX",{get:function(){return this.force*this.x}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"forceY",{get:function(){return this.force*this.y}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"x",{get:function(){if(this.line.angle>=0){if(this.line.angle<=1.5707963267948966){return(1.5707963267948966-this.line.angle)/1.5707963267948966}else{return-1+(3.141592653589793-this.line.angle)/3.141592653589793*2}}else{if(this.line.angle>=-1.5707963267948966){return Math.abs(-1.5707963267948966-this.line.angle)/1.5707963267948966}else{return-1+Math.abs(-3.141592653589793-this.line.angle)/3.141592653589793*2}}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"y",{get:function(){if(this.line.angle>=0){return 1-Math.abs(1.5707963267948966-this.line.angle)/1.5707963267948966}else{return-1+Math.abs(-1.5707963267948966-this.line.angle)/1.5707963267948966}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"filterX",{get:function(){if(this.x===0){return.5}else{var fx=Math.abs(this.forceX)/2;if(this.x<0){return(.5-fx).toFixed(2)}else{return(.5+fx).toFixed(2)}}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"filterY",{get:function(){if(this.y===0){return.5}else{var fy=Math.abs(this.forceY)/2;if(this.y<0){return 1-(.5-fy).toFixed(2)}else{return 1-(.5+fy).toFixed(2)}}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"alpha",{get:function(){return this.stickSprite.alpha},set:function(value){this.stickSprite.alpha=value;this.baseSprite.alpha=value}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"visible",{get:function(){return this.stickSprite.visible},set:function(value){this.stickSprite.visible=value;this.baseSprite.visible=value}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"distance",{get:function(){return this._distance*this._scale},set:function(value){if(this._distance!==value){this._distance=value}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"deadZone",{get:function(){return this._deadZone*this._scale},set:function(value){this._deadZone=value}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"scale",{get:function(){return this._scale},set:function(value){if(this._scale!==value){this.stickSprite.scale.set(value);this.baseSprite.scale.set(value);this.baseHitArea.setTo(this.position.x,this.position.y,this.distance*value);this.stickHitArea.setTo(this.position.x,this.position.y,this.stickSprite.width);this._scale=value}}});Object.defineProperty(Phaser.VirtualJoystick.Stick.prototype,"showOnTouch",{get:function(){return this._showOnTouch},set:function(value){if(this._showOnTouch!==value){this._showOnTouch=value;if(this._showOnTouch&&this.visible){this.visible=false}}}});Phaser.VirtualJoystick.Button=function(pad,shape,x,y,texture,upFrame,downFrame){this.pad=pad;this.upFrame=upFrame;this.downFrame=downFrame;this.sprite=this.pad.game.make.sprite(x,y,texture,upFrame);this.sprite.anchor.set(.5);if(shape===Phaser.VirtualJoystick.CIRC_BUTTON){this.hitArea=new Phaser.Circle(this.sprite.x,this.sprite.y,this.sprite.width)}else if(shape===Phaser.VirtualJoystick.RECT_BUTTON){this.hitArea=new Phaser.Rectangle(this.sprite.x,this.sprite.y,this.sprite.width,this.sprite.height)}this.pointer=null;this.enabled=true;this.isDown=false;this.isUp=true;this.onDown=new Phaser.Signal;this.onUp=new Phaser.Signal;this.timeDown=0;this.timeUp=0;this.repeatRate=0;this.key=null;this._timeNext=0;this._scale=1;this.pad.game.stage.addChild(this.sprite);this.pad.game.input.onDown.add(this.checkDown,this);this.pad.game.input.onUp.add(this.checkUp,this)};Phaser.VirtualJoystick.Button.prototype={addKey:function(keycode){if(this.key){if(this.key.keyCode===keycode){return false}this.key.onDown.removeAll();this.key.onUp.removeAll();this.pad.game.input.keyboard.removeKey(this.key);this.key=null}if(keycode){this.key=this.pad.game.input.keyboard.addKey(keycode);this.key.onDown.add(this.keyDown,this);this.key.onUp.add(this.keyUp,this)}return this.key},keyDown:function(){if(!this.isDown){this.sprite.frameName=this.downFrame;this.isDown=true;this.isUp=false;this.timeDown=this.pad.game.time.time;this.timeUp=0;this.onDown.dispatch(this,this.key)}},keyUp:function(){if(this.isDown){this.sprite.frameName=this.upFrame;this.isDown=false;this.isUp=true;this.timeUp=this.pad.game.time.time;this.onUp.dispatch(this,this.key,this.duration)}},checkDown:function(pointer){if(this.enabled&&this.isUp&&this.hitArea.contains(pointer.x,pointer.y)){this.pointer=pointer;this.sprite.frameName=this.downFrame;this.isDown=true;this.isUp=false;this.timeDown=this.pad.game.time.time;this.timeUp=0;this.onDown.dispatch(this,pointer)}},checkUp:function(pointer){if(pointer===this.pointer){this.pointer=null;this.sprite.frameName=this.upFrame;this.isDown=false;this.isUp=true;this.timeUp=this.pad.game.time.time;this.onUp.dispatch(this,pointer,this.duration)}},update:function(){if(this.repeatRate>0&&this.isDown&&this.pad.game.time.time>=this._timeNext){this.onDown.dispatch(this,this.pointer);this._timeNext=this.pad.game.time.time+this.repeatRate}},alignBottomLeft:function(spacing){if(typeof spacing==="undefined"){spacing=0}var w=this.sprite.width/2+spacing;var h=this.sprite.height/2+spacing;this.posX=w;this.posY=this.pad.game.height-h},alignBottomRight:function(spacing){if(typeof spacing==="undefined"){spacing=0}var w=this.sprite.width/2+spacing;var h=this.sprite.height/2+spacing;this.posX=this.pad.game.width-w;this.posY=this.pad.game.height-h},destroy:function(){this.pad.game.input.onDown.remove(this.checkDown,this);this.pad.game.input.onUp.remove(this.checkUp,this);this.sprite.destroy();this.onDown.dispose();this.onUp.dispose();this.hitArea=null;this.pointer=null;this._scale=null;this.pad=null}};Object.defineProperty(Phaser.VirtualJoystick.Button.prototype,"posX",{get:function(){return this.sprite.x},set:function(x){if(this.sprite.x!==x){this.sprite.x=x;this.hitArea.x=x}}});Object.defineProperty(Phaser.VirtualJoystick.Button.prototype,"posY",{get:function(){return this.sprite.y},set:function(y){if(this.sprite.y!==y){this.sprite.y=y;this.hitArea.y=y}}});Object.defineProperty(Phaser.VirtualJoystick.Button.prototype,"alpha",{get:function(){return this.sprite.alpha},set:function(value){this.sprite.alpha=value}});Object.defineProperty(Phaser.VirtualJoystick.Button.prototype,"visible",{get:function(){return this.sprite.visible},set:function(value){this.sprite.visible=value}});Object.defineProperty(Phaser.VirtualJoystick.Button.prototype,"scale",{get:function(){return this._scale},set:function(value){if(this._scale!==value){this.sprite.scale.set(value);this.hitArea.setTo(this.sprite.x,this.sprite.y,this.sprite.width);this._scale=value}}});Object.defineProperty(Phaser.VirtualJoystick.Button.prototype,"duration",{get:function(){if(this.isUp){return this.timeUp-this.timeDown}return this.game.time.time-this.timeDown}});Phaser.VirtualJoystick.DPad=function(pad,x,y,distance,texture,neutralFrame,upFrame,downFrame,leftFrame,rightFrame){this.pad=pad;this.neutralFrame=neutralFrame;this.upFrame=upFrame;this.downFrame=downFrame;this.leftFrame=leftFrame;this.rightFrame=rightFrame;this.position=new Phaser.Point(x,y);this.line=new Phaser.Line(this.position.x,this.position.y,this.position.x,this.position.y);this.sprite=this.pad.game.make.sprite(x,y,texture,neutralFrame);this.sprite.anchor.set(.5);this.baseHitArea=new Phaser.Circle(this.position.x,this.position.y,distance);this.stickHitArea=new Phaser.Circle(this.position.x,this.position.y,this.sprite.width);this.limitPoint=new Phaser.Point;this.pointer=null;this.enabled=true;this.isDown=false;this.isUp=true;this.onDown=new Phaser.Signal;this.onUp=new Phaser.Signal;this.onMove=new Phaser.Signal;this.onUpdate=new Phaser.Signal;this.timeDown=0;this.timeUp=0;this.angle=0;this.angleFull=0;this.quadrant=0;this.multiQuadrant=[];this.multiDirections={up:false,right:false,down:false,left:false};this.octant=0;this.direction=Phaser.NONE;this._distance=distance;this._deadZone=distance*.15;this._scale=1;this._tracking=false;this._showOnTouch=false;this.pad.game.stage.addChild(this.sprite);this.pad.game.input.onDown.add(this.checkDown,this);this.pad.game.input.onUp.add(this.checkUp,this);this.pad.game.input.addMoveCallback(this.moveStick,this)};Phaser.VirtualJoystick.DPad.prototype={checkDown:function(pointer){if(this.enabled&&this.isUp){this.pointer=pointer;this.line.end.copyFrom(pointer);if(this._showOnTouch){this.line.start.copyFrom(pointer);this.posX=pointer.x;this.posY=pointer.y;this.visible=true;this.setDown()}else{if(this.stickHitArea.contains(pointer.x,pointer.y)){if(this.line.length<=this.deadZone){this._tracking=true}else{this.setDown();this.moveStick()}}}}},checkUp:function(pointer){if(pointer===this.pointer){this.pointer=null;this.stickHitArea.x=this.position.x;this.stickHitArea.y=this.position.y;this.sprite.frameName=this.neutralFrame;this.line.end.copyFrom(this.line.start);this.isDown=false;this.isUp=true;this.direction=Phaser.NONE;this.timeUp=this.pad.game.time.time;this.onUp.dispatch(this,pointer);if(this._showOnTouch){this.visible=false}}},setDown:function(){this.isDown=true;this.isUp=false;this.timeDown=this.pad.game.time.time;this.timeUp=0;this._tracking=false;this.checkArea();this.onDown.dispatch(this,this.pointer)},checkArea:function(){this.angle=this.pad.game.math.radToDeg(this.line.angle);this.angleFull=this.angle;this.spread=20;this.multiQuadrant=[false,false,false,false];this.multiDirections={up:false,right:false,down:false,left:false};if(this.angleFull<0){this.angleFull+=360}this.octant=45*Math.round(this.angleFull/45);if(this.angleFull+this.spread>=45&&this.angleFull-this.spread<135){this.quadrant=1;this.multiQuadrant[1]=true}else if(this.angleFull+this.spread>=225&&this.angleFull-this.spread<315){this.quadrant=3;this.multiQuadrant[3]=true}if(this.angleFull+this.spread>=135&&this.angleFull-this.spread<225){this.quadrant=2;this.multiQuadrant[2]=true}else if(this.angleFull+this.spread>=315||this.angleFull-this.spread<45){this.quadrant=0;this.multiQuadrant[0]=true}},moveStick:function(){if(!this.pointer||!this.isDown&&!this._tracking){this.multiDirections={up:false,right:false,down:false,left:false};this.direction=Phaser.NONE;this.sprite.frameName=this.neutralFrame;return}this.line.end.copyFrom(this.pointer);this.checkArea();if(!this.isDown&&this.line.length<=this.deadZone){this.direction=Phaser.NONE;this.sprite.frameName=this.neutralFrame;return}if(this._tracking){this.setDown()}if(this.line.length<this.baseHitArea.radius){if(this.motionLock===Phaser.VirtualJoystick.NONE){this.stickHitArea.x=this.pointer.x;this.stickHitArea.y=this.pointer.y}else if(this.motionLock===Phaser.VirtualJoystick.HORIZONTAL){this.stickHitArea.x=this.pointer.x}else if(this.motionLock===Phaser.VirtualJoystick.VERTICAL){this.stickHitArea.y=this.pointer.y}}else{this.baseHitArea.circumferencePoint(this.line.angle,false,this.limitPoint);if(this.motionLock===Phaser.VirtualJoystick.NONE){this.stickHitArea.x=this.limitPoint.x;this.stickHitArea.y=this.limitPoint.y}else if(this.motionLock===Phaser.VirtualJoystick.HORIZONTAL){this.stickHitArea.x=this.limitPoint.x}else if(this.motionLock===Phaser.VirtualJoystick.VERTICAL){this.stickHitArea.y=this.limitPoint.y}}if(this.quadrant===1||this.multiQuadrant[1]){this.sprite.frameName=this.downFrame;this.direction=Phaser.DOWN;this.multiDirections.down=true}else if(this.quadrant===3||this.multiQuadrant[3]){this.sprite.frameName=this.upFrame;this.direction=Phaser.UP;this.multiDirections.up=true}if(this.quadrant===2||this.multiQuadrant[2]){this.sprite.frameName=this.leftFrame;this.direction=Phaser.LEFT;this.multiDirections.left=true}else if(this.quadrant===0||this.multiQuadrant[0]){this.sprite.frameName=this.rightFrame;this.direction=Phaser.RIGHT;this.multiDirections.right=true}this.onMove.dispatch(this,this.x,this.y)},update:function(){if(this.isDown&&!this._tracking){this.onUpdate.dispatch(this,this.x,this.y)}},alignBottomLeft:function(spacing){if(typeof spacing==="undefined"){spacing=0}var w=this.sprite.width/2+spacing;var h=this.sprite.height/2+spacing;this.posX=w;this.posY=this.pad.game.height-h},alignBottomRight:function(spacing){if(typeof spacing==="undefined"){spacing=0}var w=this.sprite.width/2+spacing;var h=this.sprite.height/2+spacing;this.posX=this.pad.game.width-w;this.posY=this.pad.game.height-h},destroy:function(){this.pad.game.input.onDown.remove(this.checkDown,this);this.pad.game.input.onUp.remove(this.checkUp,this);var mc=this.pad.game.input.moveCallbacks;for(var i=0;i<mc.length;i++){if(mc.callback===this.moveStick&&mc.context===this){mc.splice(i,1);break}}this.sprite.destroy();this.stickHitArea=null;this.baseHitArea=null;this.line=null;this.limitPoint=null;this.onDown.dispose();this.onUp.dispose();this.pointer=null;this._scale=null;this.pad=null},debug:function(sticks,text,x){if(typeof sticks==="undefined"){sticks=true}if(typeof text==="undefined"){text=true}if(typeof x==="undefined"){x=this.sprite.right}var debug=this.pad.game.debug;if(sticks){debug.context.lineWidth=2;debug.geom(this.baseHitArea,"rgba(255, 0, 0, 1)",false);debug.geom(this.stickHitArea,"rgba(0, 255, 0, 1)",false);debug.geom(this.line,"rgba(255, 255, 0, 1)");debug.context.lineWidth=1}if(text){var shadow=debug.renderShadow;var tx=x;var ty=this.sprite.y-48;debug.renderShadow=true;debug.text("X: "+this.x,tx,ty);debug.text("Y: "+this.y,tx,ty+24);debug.text("Distance: "+this.distance,tx,ty+48);debug.text("Quadrant: "+this.quadrant,tx,ty+96);debug.text("Octant: "+this.octant,tx,ty+120);debug.renderShadow=shadow}}};Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"rotation",{get:function(){return this.line.angle}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"posX",{get:function(){return this.position.x},set:function(x){if(this.position.x!==x){this.position.x=x;this.sprite.x=x;this.baseHitArea.x=x;this.stickHitArea.x=x;this.line.start.x=x;this.line.end.x=x}}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"posY",{get:function(){return this.position.y},set:function(y){if(this.position.y!==y){this.position.y=y;this.sprite.y=y;this.baseHitArea.y=y;this.stickHitArea.y=y;this.line.start.y=y;this.line.end.y=y}}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"x",{get:function(){if(this.direction===Phaser.LEFT){return-1}else if(this.direction===Phaser.RIGHT){return 1}else{return 0}}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"y",{get:function(){if(this.direction===Phaser.UP){return-1}else if(this.direction===Phaser.DOWN){return 1}else{return 0}}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"alpha",{get:function(){return this.sprite.alpha},set:function(value){this.sprite.alpha=value}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"visible",{get:function(){return this.sprite.visible},set:function(value){this.sprite.visible=value}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"distance",{get:function(){return this._distance*this._scale},set:function(value){if(this._distance!==value){this._distance=value}}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"deadZone",{get:function(){return this._deadZone*this._scale},set:function(value){this._deadZone=value}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"scale",{get:function(){return this._scale},set:function(value){if(this._scale!==value){this.sprite.scale.set(value);this.baseHitArea.setTo(this.position.x,this.position.y,this.distance*value);this.stickHitArea.setTo(this.position.x,this.position.y,this.sprite.width);this._scale=value}}});Object.defineProperty(Phaser.VirtualJoystick.DPad.prototype,"showOnTouch",{get:function(){return this._showOnTouch},set:function(value){if(this._showOnTouch!==value){this._showOnTouch=value;if(this._showOnTouch&&this.visible){this.visible=false}}}});
